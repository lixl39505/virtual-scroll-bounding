!function(root,factory){"function"==typeof define&&define.amd?define([],factory):"object"==typeof module&&module.exports?module.exports=factory():root.VirtualScrollBounding=factory()}("undefined"!=typeof self?self:this,(function(){function sum(arr,s,e){arr=arr||[],void 0===s&&(s=0),void 0===e&&(e=arr.length-1);for(var r=0,i=s;i<=e;i++)r+=arr[i]||0;return r}function isNullOrUnDef(v){return null==v}var hasOwnProperty=Object.prototype.hasOwnProperty;function assign(){var to=arguments[0],arr=Array.prototype.slice.call(arguments,1);if(!to||"object"!=typeof to)throw new Error(to+" must be object");for(var i=0;i<arr.length;i++){var from=arr[i];for(var k in from)hasOwnProperty.call(from,k)&&(to[k]=from[k])}return to}function VirtualScrollBounding(options){options=assign({list:[],minRowHeight:48,minColWidth:100,virtualLength:48,clientHeight:0,adjustRowHeight:!1},options),this.list=options.list,this.minRowHeight=options.minRowHeight,this.adjustRowHeight=options.adjustRowHeight,this.virtualLength=options.virtualLength,this.clientHeight=options.clientHeight,this.scrollY=0,this.position={init:!1,adjusting:!1,vh:0,ah:0,rows:[],columns:[],ahs:[],aws:[],rowCount:0,colCount:0,top:0,left:0,topRem:0,leftRem:0,scrollY:0,scrollX:0,lastCalcScrollY:0,lastCalcScrollX:0,sr:0,cr:0,er:0}}return assign(VirtualScrollBounding.prototype,{_calc(){var list=this.list,clientHeight=this.clientHeight,scrollY=this.scrollY;if(!this.position.adjusting){scrollY<0&&(scrollY=0);var pos=this.position,size=this.virtualLength,mh=this.minRowHeight,dt=scrollY-pos.lastCalcScrollY;!1===pos.init&&(pos.init=!0,pos.rowCount=list.length,pos.vh=pos.rowCount*mh,pos.er=Math.min(this.virtualLength-1,pos.rowCount-1),pos.rows=list.slice(pos.sr,pos.er+1),pos.ahs=function(e,n){void 0===n&&(n=0);for(var r=[],i=0;i<n;i++)r.push(e);return r}(mh,size),pos.ah=sum(pos.ahs));var ah=pos.ah,rowCount=pos.rowCount,top=pos.top,sr=pos.sr,er=pos.er,lastCalcScrollY=pos.lastCalcScrollY;pos.rowCount=list.length,pos.scrollY=scrollY,rowCount!==pos.rowCount?reCalc():dt>0?dt>(ah-(lastCalcScrollY-top)-clientHeight)/2&&(scrollY-top<=ah?relativeCalc():reCalc()):dt<0&&dt<-(lastCalcScrollY-top)/2&&(scrollY-top>0?relativeCalc():reCalc()),sr===pos.sr&&er===pos.er&&rowCount===pos.rowCount||(pos.lastCalcScrollY=scrollY,pos.rows=this.list.slice(pos.sr,pos.er+1),this._virtualScrollTo(),this.adjustRowHeight&&(pos.adjusting=!0))}function reCalc(){var extra=ah-(pos.er-pos.sr+1)*mh;pos.vh=pos.rowCount*mh,pos.cr=Math.ceil((scrollY-extra)/mh),pos.sr=Math.max(pos.cr-Math.ceil(size/3),0),pos.er=Math.min(pos.sr+size-1,pos.rowCount-1),pos.topRem=pos.cr*mh-scrollY+extra}function relativeCalc(){pos.cr=function(arr,threshold){void 0===threshold&&(threshold=0);var i,r=0,e=(arr=arr||[]).length-1;for(i=0;i<=e;i++)if((r+=arr[i])>threshold)return i;return i}(pos.ahs,scrollY-top)+sr+1,pos.topRem=sum(pos.ahs,0,pos.cr-pos.sr-1)-(scrollY-top),pos.sr=Math.max(pos.cr-Math.ceil(size/3),0),pos.er=Math.min(pos.sr+size-1,pos.rowCount-1)}},_virtualScrollTo(){var pos=this.position,sr=pos.sr,cr=pos.cr,scrollY=pos.scrollY;pos.top=sr>0?scrollY-sum(pos.ahs,0,cr-sr-1)+pos.topRem:0,pos.top<0&&(pos.scrollY+=-pos.top,pos.top=0,pos.lastCalcScrollY=pos.scrollY)},adjust(ahs){if(!1!==this.position.adjusting){if(!ahs||!ahs.splice)throw new Error("ahs must be array number");var pos=this.position,mh=this.minRowHeight;pos.ahs=ahs,pos.ah=sum(ahs),pos.vh=pos.rowCount*mh+pos.ah-ahs.length*mh,this._virtualScrollTo(),pos.adjusting=!1}},scrollTo(x,y){"object"==typeof x&&(y=x.top,x=x.left),isNullOrUnDef(x)||(this.scrollX=x),isNullOrUnDef(y)||(this.scrollY=y),this._calc()}}),VirtualScrollBounding}));